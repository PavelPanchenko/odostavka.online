#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∫–∏ –Ω–∞ Vercel —Å –Ω–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏

echo "üöÄ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∫–∏ –Ω–∞ Vercel..."

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø–∞–ø–∫—É –∞–¥–º–∏–Ω–∫–∏
cd food-delivery-admin

# –°–æ–∑–¥–∞–µ–º .env.local —Ñ–∞–π–ª —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
echo "üìù –°–æ–∑–¥–∞–Ω–∏–µ .env.local..."
cat > .env.local << 'EOF'
# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
NEXT_PUBLIC_API_URL=https://odostavka.online/api
NEXT_PUBLIC_API_DOMAIN=odostavka.online
EOF

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ñ–∞–π–ª —Å–æ–∑–¥–∞–ª—Å—è
if [ -f ".env.local" ]; then
    echo "‚úÖ .env.local —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ"
    echo "üìã –°–æ–¥–µ—Ä–∂–∏–º–æ–µ .env.local:"
    cat .env.local
else
    echo "‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è .env.local"
    exit 1
fi

# –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–µ–∫—Ç
echo "üî® –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞..."
npm run build

if [ $? -eq 0 ]; then
    echo "‚úÖ –°–±–æ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–∞"
else
    echo "‚ùå –û—à–∏–±–∫–∞ —Å–±–æ—Ä–∫–∏"
    exit 1
fi

# –î–µ–ø–ª–æ–∏–º –Ω–∞ Vercel (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
echo "üöÄ –î–µ–ø–ª–æ–π –Ω–∞ Vercel..."
if command -v vercel &> /dev/null; then
    vercel --prod
    echo "‚úÖ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω"
else
    echo "‚ö†Ô∏è  Vercel CLI –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –¥–µ–ø–ª–æ–π –≤—Ä—É—á–Ω—É—é:"
    echo "   1. –ó–∞–π–¥–∏—Ç–µ –≤ –ø–∞–Ω–µ–ª—å Vercel"
    echo "   2. –û–±–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:"
    echo "      NEXT_PUBLIC_API_URL=https://odostavka.online/api"
    echo "      NEXT_PUBLIC_API_DOMAIN=odostavka.online"
    echo "   3. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç"
fi

echo "üéâ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
